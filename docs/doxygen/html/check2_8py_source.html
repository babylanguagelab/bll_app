<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Baby Language Lab Scripts: C:/Users/Wayne/Documents/baby-lab/bll_app/data_structs/check2.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bll_icon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Baby Language Lab Scripts
   </div>
   <div id="projectbrief">A collection of data processing tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('check2_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">check2.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="check2_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="code" href="namespacedata__structs_1_1check2.html">    1</a></span>&#160;<span class="comment">## @package data_structs.check2</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedata__structs_1_1base__objects.html">data_structs.base_objects</a> <span class="keyword">import</span> DBObject</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedb_1_1bll__database.html">db.bll_database</a> <span class="keyword">import</span> DBConstants</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedata__structs_1_1test2.html">data_structs.test2</a> <span class="keyword">import</span> Test2</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> pickle</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">## This class represents one trial&#39;s worth of data for the reliability2 app.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html">   11</a></span>&#160;<span class="keyword">class </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html" title="This class represents one trial&#39;s worth of data for the reliability2 app.">Check2</a>(<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html" title="Represents an object that can be stored in the database.">DBObject</a>):</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="comment">## Constructor</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment"># @param self</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment"># @param csv_filename (string) path to the csv file that will be used - blocks will be picked from this file and presented to the user (see parsers.csv_parser for a list of the columns that must be present. In addition to those, we also need &quot;environment&quot; and &quot;activity&quot; columns.)</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment"># @param wav_foldername (string) path to a folder containing all the wav files that correspond to blocks that could be picked from the csv file</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="comment"># @param activities (list) list of strings, one for each activity that will be run (within each environment). E.g. [&#39;mealtime&#39;, &#39;playtime&#39;, ...]</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="comment"># @param environments (list) list of strings, one for each environment that will be run. E.g [&#39;home&#39;, &#39;daycare centre&#39;, ...]</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="comment"># @param blocks_per_activity (int) the number of 5 minute blocks that will be picked for each activity (blocks will be picked for each activity, separately for each environment)</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment"># @param completed (string=None) timestamp string representing the date/time when this check2 was completed. Is None if it has not yet been completed by the user.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment"># @param created (string=None) timestamp string representing the date/time when this check2 was created by the user. This is assigned by the database in the insert() method. So if the check2 is not in the DB, this may be None.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment"># @param modified (string=None) timestamp string representing the last time this check2 was modified by the user. For example, the last time the progress in the application was saved when working on this check. This is assigned by the DB. It will be None if the check2 has never been saved in an incomplete trial. It is possible for check2s to be completed, but not modified (if the user goes through the whole trial without saving/quitting).</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment"># @param test2s (list=[]) a list of all the Test2 data structure objects for this trial. Each Test2 object represents (and contains all the data for) the input for a single block that the user has completed.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="comment"># @param test2_index (int=0) the index we are currently sitting at in the test2 list (previous param). This information is used to restore the state of the app to where the user left off, when a saved check2 is loaded back up.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment"># @param db_id (int=None) the primary key value of this check2 in the check2 database table. In general, code should not set this. It&#39;s set from db_select(), and upon db_insert(). Will be None if object is not yet in the DB.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0180f6c8d616a10f3d33d0ad2014d358" title="Constructor.">__init__</a>(</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        self,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        csv_filename,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        wav_foldername,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        activities, <span class="comment">#array</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        environments, <span class="comment">#array</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        blocks_per_activity,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        completed=<span class="keywordtype">None</span>, <span class="comment">#timestamp</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        created=<span class="keywordtype">None</span>, <span class="comment">#timestamp</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        modified=<span class="keywordtype">None</span>, <span class="comment">#timestamp</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        test2s=[], <span class="comment">#array of Test2 objects</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        test2_index=0, <span class="comment">#index of the test2 to display in the UI</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        db_id=<span class="keywordtype">None</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0180f6c8d616a10f3d33d0ad2014d358">   38</a></span>&#160;        ):</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        super(Check2, self).<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0180f6c8d616a10f3d33d0ad2014d358" title="Constructor.">__init__</a>()</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a1656c4776bb0c06d1c25ce41805af9a2">   42</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a1656c4776bb0c06d1c25ce41805af9a2">csv_filename</a> = csv_filename</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a002dd1c273212ecacea59bd213906797">   43</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a002dd1c273212ecacea59bd213906797">wav_foldername</a> = wav_foldername</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d357fe9119bc229d7cd8064f7ba3a3b">   44</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d357fe9119bc229d7cd8064f7ba3a3b">activities</a> = activities</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#afb12425c4d75e0c499c0506ecd93a32a">   45</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#afb12425c4d75e0c499c0506ecd93a32a">environments</a> = environments</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ab2e62e4a3032ce581d2024bba3259ba1">   46</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ab2e62e4a3032ce581d2024bba3259ba1">blocks_per_activity</a> = blocks_per_activity</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ad7482ef8c90711cf332670acf02dee46">   47</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ad7482ef8c90711cf332670acf02dee46">completed</a> = completed</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#adaef43be273cda65b2e9f6a5581fea0d">   48</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#adaef43be273cda65b2e9f6a5581fea0d">created</a> = created</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0c60b249a18131f950c7f295061f291b">   49</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0c60b249a18131f950c7f295061f291b">modified</a> = modified</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d8719c07c0425e1a9da138817206237">   50</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d8719c07c0425e1a9da138817206237">test2s</a> = test2s</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#abcf489c78b2e289f40657ce0ae54afe2">   51</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#abcf489c78b2e289f40657ce0ae54afe2">test2_index</a> = test2_index</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a1a6f255e2e880599bcf5829c4f1a3978">   52</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a> = db_id</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">## Overwrites the completed timestamp (both in the DB and the object attribute for this instance) with the current date/time.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment"># @param self</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment"># @param db (BLLDatabase) a database object</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#af725da9a28eb4f52d3ced3de34fd2d4a">   57</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#af725da9a28eb4f52d3ced3de34fd2d4a" title="Overwrites the completed timestamp (both in the DB and the object attribute for this instance) with t...">update_completed</a>(self, db):</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">#allow the DB to set the timestamp value</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ae9602daca7534b083b93a61ce166c0eb" title="Performs a db update of a timestamp column, setting it to the date/time at the point this method is e...">_update_timestamp</a>(db, <span class="stringliteral">&#39;completed&#39;</span>)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="comment">#then re-select it and update the instance attribute</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ad7482ef8c90711cf332670acf02dee46">completed</a> = db.select(<span class="stringliteral">&#39;checks2&#39;</span>, [<span class="stringliteral">&#39;datetime(completed,\&#39;localtime\&#39;)&#39;</span>], <span class="stringliteral">&#39;id=?&#39;</span>, [self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>])</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">## Overwrites the modified timestamp (both in the DB and the object attribute for this instance) with the current date/time.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment"># @param self</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment"># @param db (BLLDatabase) a database object</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a24ad18e1d347232ce3817e6aa38a3028">   66</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a24ad18e1d347232ce3817e6aa38a3028" title="Overwrites the modified timestamp (both in the DB and the object attribute for this instance) with th...">update_modified</a>(self, db):</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="comment">#allow the DB to set the timestamp value</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ae9602daca7534b083b93a61ce166c0eb" title="Performs a db update of a timestamp column, setting it to the date/time at the point this method is e...">_update_timestamp</a>(db, <span class="stringliteral">&#39;modified&#39;</span>)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">#select it back and update the instance attribute</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0c60b249a18131f950c7f295061f291b">modified</a> = db.select(<span class="stringliteral">&#39;checks2&#39;</span>, [<span class="stringliteral">&#39;datetime(modified,\&#39;localtime\&#39;)&#39;</span>], <span class="stringliteral">&#39;id=?&#39;</span>, [self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>])</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">## Updates the test2_index value in the database. It is set to the current value for this instance. If the instance is not already in the dd, an exception is raised.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment"># @param self</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment"># @param db (BLLDatabase) a database object</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a43ab8026e499a248b1fa458fea92d856">   75</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a43ab8026e499a248b1fa458fea92d856" title="Updates the test2_index value in the database.">update_test2_index</a>(self, db):</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a> != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            db.update(<span class="stringliteral">&#39;checks2&#39;</span>, [<span class="stringliteral">&#39;test2_index&#39;</span>], <span class="stringliteral">&#39;id=?&#39;</span>, [self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#abcf489c78b2e289f40657ce0ae54afe2">test2_index</a>, self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>])</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Cannot update test2_index on Check2 instance that is not in the databse.&#39;</span>)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">## Performs a db update of a timestamp column, setting it to the date/time at the point this method is executed. If this instance is not already in the db, an exception is raised.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment"># @param self</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment"># @param db (BLLDatabase) a database object</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment"># @param col (string) name of the timestamp column from the checks2 database table to update.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ae9602daca7534b083b93a61ce166c0eb">   85</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ae9602daca7534b083b93a61ce166c0eb" title="Performs a db update of a timestamp column, setting it to the date/time at the point this method is e...">_update_timestamp</a>(self, db, col):</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a> != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            db.update_timestamp_col(<span class="stringliteral">&#39;checks2&#39;</span>, col, <span class="stringliteral">&#39;id=?&#39;</span>, [self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>])</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Cannot update timestamp because Check2 instance is not in the database.&#39;</span>)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">## See superclass description.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment"># If any of this instance&#39;s test2 objects are not yet in the DB, this method will insert them as well.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a7f45d9a0d40a3b7926fd6e4f4f6a7066">   93</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a7f45d9a0d40a3b7926fd6e4f4f6a7066" title="See superclass description.">db_insert</a>(self, db):</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        super(Check2, self).<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a7f45d9a0d40a3b7926fd6e4f4f6a7066" title="See superclass description.">db_insert</a>(db)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        cols = <span class="stringliteral">&#39;csv_file wav_folder activities environments blocks_per_activity completed test2_index&#39;</span>.split() <span class="comment">#omit the &#39;modified&#39; and &#39;created&#39; columns - they will default to current timestamp</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">#pickle the lists of activities and environments (convert them to a format in which we can just store the object instance in the database), as they are of variable length.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        row = [self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a1656c4776bb0c06d1c25ce41805af9a2">csv_filename</a>, self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a002dd1c273212ecacea59bd213906797">wav_foldername</a>, pickle.dumps(self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d357fe9119bc229d7cd8064f7ba3a3b">activities</a>), pickle.dumps(self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#afb12425c4d75e0c499c0506ecd93a32a">environments</a>), self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ab2e62e4a3032ce581d2024bba3259ba1">blocks_per_activity</a>, self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#ad7482ef8c90711cf332670acf02dee46">completed</a>, self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#abcf489c78b2e289f40657ce0ae54afe2">test2_index</a>]</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment">#grab the last inserted id and use it to assign this object&#39;s db_id</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        last_ids = db.insert(<span class="stringliteral">&#39;checks2&#39;</span>, cols, [row])</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a> = last_ids[0]</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">#re-select and update this instance&#39;s timestamp attributes (these are always assigned by the DB)</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        checks2_rows = db.select(<span class="stringliteral">&#39;checks2&#39;</span>, [<span class="stringliteral">&quot;datetime(created,&#39;localtime&#39;)&quot;</span>, <span class="stringliteral">&quot;datetime(modified,&#39;localtime&#39;)&quot;</span>], <span class="stringliteral">&#39;id=?&#39;</span>, [str(self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>)])</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#adaef43be273cda65b2e9f6a5581fea0d">created</a> = datetime.strptime(checks2_rows[0][0], DBConstants.DB_DATETIME_FMT)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a0c60b249a18131f950c7f295061f291b">modified</a> = datetime.strptime(checks2_rows[0][1], DBConstants.DB_DATETIME_FMT)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">#ensure that all of this check2&#39;s test2 objects are in the DB</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d8719c07c0425e1a9da138817206237">test2s</a>:</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">for</span> t <span class="keywordflow">in</span> self.<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a8d8719c07c0425e1a9da138817206237">test2s</a>:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="keywordflow">if</span> t.db_id == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    t.db_insert(db)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">## See superclass description.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a2fcafa3ca21459546a9bd55f2fb5cb8d">  117</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a2fcafa3ca21459546a9bd55f2fb5cb8d" title="See superclass description.">db_delete</a>(self, db):</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        super(Check2, self).<a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a2fcafa3ca21459546a9bd55f2fb5cb8d" title="See superclass description.">db_delete</a>(db)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">#this will cascade and remove all corresponding test2 rows</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        num_rows = db.delete(<span class="stringliteral">&#39;checks2&#39;</span>, <span class="stringliteral">&#39;id=?&#39;</span>, [self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a>])</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> num_rows == 1:</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            self.<a class="code" href="classdata__structs_1_1base__objects_1_1_d_b_object.html#a431468ae067a0e8f27b36de1701e0a36">db_id</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">return</span> num_rows</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">## See superclass description.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    @staticmethod</div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a4adefd802ba45090f1ded6a74fc94883">  129</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1check2_1_1_check2.html#a4adefd802ba45090f1ded6a74fc94883" title="See superclass description.">db_select</a>(db, ids=[]):</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        DBObject.db_select(db, ids)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">#build the SQL where clause using the ids passed in</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        where_cond = DBObject._build_where_cond_from_ids(ids)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="comment">#do the select to retrieve the a list of raw data</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        rows = db.select(<span class="stringliteral">&#39;checks2&#39;</span>, <span class="stringliteral">&#39;csv_file wav_folder activities environments blocks_per_activity datetime(completed,\&#39;localtime\&#39;) datetime(created,\&#39;localtime\&#39;) datetime(modified,\&#39;localtime\&#39;) test2_index id&#39;</span>.split(), where_cond)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">#create Check2 objects from the selected data and return them</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        check2_list = []</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">for</span> cur_row <span class="keywordflow">in</span> rows:</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="comment">#each check2 has zero or more Test2s, which can be retrieved using this static method</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            test2s = Test2.db_select_by_check2(db, cur_row[9])</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            check2 = <a class="code" href="classdata__structs_1_1check2_1_1_check2.html" title="This class represents one trial&#39;s worth of data for the reliability2 app.">Check2</a>(</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                cur_row[0],</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                cur_row[1],</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="comment">#un-pickle the lists of activities and environments (the loads() call will return an instance of a list)</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                pickle.loads(cur_row[2]),</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                pickle.loads(cur_row[3]),</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                cur_row[4],</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                cur_row[5],</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                cur_row[6],</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                cur_row[7],</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                test2s,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                cur_row[8],</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                cur_row[9]</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                )</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            check2_list.append(check2)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> check2_list</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8dba4be13e7b5b450dd533232b439a45.html">data_structs</a></li><li class="navelem"><a class="el" href="check2_8py.html">check2.py</a></li>
    <li class="footer">Generated on Fri Jan 9 2015 16:37:09 for Baby Language Lab Scripts by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
