<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Baby Language Lab Scripts: C:/Users/Wayne/Documents/baby-lab/bll_app/data_structs/utterance.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bll_icon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Baby Language Lab Scripts
   </div>
   <div id="projectbrief">A collection of data processing tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('utterance_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">utterance.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="utterance_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="code" href="namespacedata__structs_1_1utterance.html">    1</a></span>&#160;<span class="comment">## @package data_structs.utterance</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedata__structs_1_1base__objects.html">data_structs.base_objects</a> <span class="keyword">import</span> BLLObject</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedb_1_1bll__database.html">db.bll_database</a> <span class="keyword">import</span> DBConstants</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparsers_1_1errors.html">parsers.errors</a> <span class="keyword">import</span> ParserError, ParserWarning</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">## This class represents an Utterance (though this class&#39;s representation may differ slightly from the linguistic definition). Utterances. For TRS files, an Utterance object corresponds to a single line of text following a &quot;sync&quot; or &quot;who&quot; tag. For CSV files, an Utterance object corresponds to a single row.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># Utterances are usually contained within a parent Segment object (corresponding to a &quot;Turn&quot; tag in a TRS file), and contain a pointer back to this parent Segment object. There may multiple utterances in a single Segment (see Segment.utters property), but each Utterance may only belong to one Segment.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">#Utterances may be chained together (via transcriber C/I codes - see transcriber manual). Such a link is represented using the &#39;next&#39; and &#39;prev&#39; instance variables, which point to adjacent Utterances in the chain. These should never by linked circularly (i.e. it is impossible for a transcriber to code a circularly linked utterance).</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># Unlike Segments, utterances are not stored in the database, and should never be manually constructed. Instead, they are generated by Parser objects (see parsers directory).</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html">   14</a></span>&#160;<span class="keyword">class </span><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html" title="This class represents an Utterance (though this class&#39;s representation may differ slightly from the l...">Utterance</a>(<a class="code" href="classdata__structs_1_1base__objects_1_1_b_l_l_object.html" title="A custom object that provides some handy debugging routines to subclasses.">BLLObject</a>):</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment">#This is a unique identifies that is given to each Utterance object. (This provides a simple way to index them within the Parser classes.)</span></div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#af3dd7c5de5826824744594e354287c57">   16</a></span>&#160;    next_id = 0</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="comment">## Constructor. Typically, this object is not constructed manually, so no parameters are provided. Instead, the parser objects create Utterances and set their parameters as they process a CSV/TRS file.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a75ef5b4be11de09f24b80a324e966508">   20</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a75ef5b4be11de09f24b80a324e966508" title="Constructor.">__init__</a>(self):</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#af291041199e7bdd256271a1613eb291f">   21</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#af291041199e7bdd256271a1613eb291f">speaker</a> = <span class="keywordtype">None</span>         <span class="comment">#Speaker object, obtained from enclosing segment</span></div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">   22</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a> = <span class="keywordtype">None</span>    <span class="comment">#transcriber-written text (string) containing the words spoken in this utternace</span></div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a50f772a9e22e270aba1674075821f6d6">   23</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a50f772a9e22e270aba1674075821f6d6">start</a> = <span class="keywordtype">None</span>           <span class="comment">#absolute start time (float)</span></div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a3ea486724bfb440a2cd2d1b98dc60247">   24</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a3ea486724bfb440a2cd2d1b98dc60247">end</a> = <span class="keywordtype">None</span>             <span class="comment">#absolute end time (float)</span></div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a466c2ea3760090cb4335d2e5138b14ef">   25</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a466c2ea3760090cb4335d2e5138b14ef">lena_notes</a> = <span class="keywordtype">None</span>      <span class="comment">#(string) lena markings like &quot;VOC&quot; - see DBConstants.LENA_NOTES_CODES</span></div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a64e7319418799432a6b993168eb3a47b">   26</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a64e7319418799432a6b993168eb3a47b">lena_codes</a> = []        <span class="comment">#(list of strings) lena generated codes</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac1f1a12c625d9ecfead4ce9a95b0ffd2">   27</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac1f1a12c625d9ecfead4ce9a95b0ffd2">trans_codes</a> = []       <span class="comment">#(list of strings) transcriber codes (see transcriber manual / DBConstants.TRANS_CODES</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a8ed083b9ab90aa7f59f365da687273aa">   28</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a8ed083b9ab90aa7f59f365da687273aa">next</a> = <span class="keywordtype">None</span>            <span class="comment">#(Utterance or None) pointer to the next Utterance in the chain, if any</span></div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#aa4c328f520a8591c6baae4eca4837e20">   29</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#aa4c328f520a8591c6baae4eca4837e20">prev</a> = <span class="keywordtype">None</span>            <span class="comment">#(Utterance or None) pointer to the previous Utterence in the chain, if any</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac8b2ee5e31c41d90a85af2b16fec727b">   30</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac8b2ee5e31c41d90a85af2b16fec727b">is_trans_overlap</a> = <span class="keyword">False</span> <span class="comment">#(boolean) True if this object represents was marked as overlapping by the transcribers using the angle brackets (&lt;, &gt;) - see transcriber manual</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#aef3527fe35917ca5085d050f526557b1">   31</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#aef3527fe35917ca5085d050f526557b1">seg</a> = <span class="keywordtype">None</span>               <span class="comment">#(Segment) pointer to the enclosing Segment object</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a0cb35b62abba94048423bb5476fad31c">   32</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a0cb35b62abba94048423bb5476fad31c">is_dot_split</a> = <span class="keyword">False</span></div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a01a5f6fc56f252fad916e6f2b2d9f779">   33</a></span>&#160;        self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a01a5f6fc56f252fad916e6f2b2d9f779">id</a> = Utterance.next_id   <span class="comment">#(int) unique id for each object that&#39;s created</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        Utterance.next_id += 1</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">## Gives a string-representation of this utterance. Also see superclass definition.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">#  @param</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">#  @returns (string) a string with formatted info suitable for printing to the console</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a49241fea37ed3c969a6a4fd9535ae89c">   40</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a49241fea37ed3c969a6a4fd9535ae89c" title="Gives a string-representation of this utterance.">__str__</a>(self):</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="comment">#print out all attributes, except for these</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        output = BLLObject.__str__(self, [<span class="stringliteral">&#39;next&#39;</span>, <span class="stringliteral">&#39;prev&#39;</span>, <span class="stringliteral">&#39;seg&#39;</span>])</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="comment">#Just print segment number (printing out whole segment would result in infinite recursion, since segment prints out this utterance)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        output += <span class="stringliteral">&#39;-seg: %s\n&#39;</span> % (self.seg.num)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="comment">#print out id of next/prev utterance in the chain, if present</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        output += <span class="stringliteral">&#39;-next: %s\n&#39;</span> % (str(self.next.id) <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a8ed083b9ab90aa7f59f365da687273aa">next</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;None&#39;</span>)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        output += <span class="stringliteral">&#39;-prev: %s\n&#39;</span> % (str(self.prev.id) <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#aa4c328f520a8591c6baae4eca4837e20">prev</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;None&#39;</span>)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">return</span> output</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">## Checks if this Utterance can be linked (chained via the next/prev instance vars) to other Utterances. This is used by the parsers when they go through a file. Utterances that represent silence, for example, should not be linked.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">#  @returns (boolean) True if it&#39;s ok to link this Utterance, False otherwise</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a59a7949e2358057906b40df03801b3d6">   55</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a59a7949e2358057906b40df03801b3d6" title="Checks if this Utterance can be linked (chained via the next/prev instance vars) to other Utterances...">is_linkable</a>(self):</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        is_linkable = <span class="keyword">True</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">#certain speakers (like silence) are not linkable. See the db table &#39;speaker_codes&#39; (specifically, the &#39;is_linkable&#39; column) for specific details.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        i = 0</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">while</span> is_linkable <span class="keywordflow">and</span> i &lt; len(self.seg.speakers):</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="comment">#if not self.seg.speakers[i].speaker_codeinfo:</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="comment">#    print self.seg.speakers[i].speaker_id</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            is_linkable = self.seg.speakers[i].speaker_codeinfo.is_linkable</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            i += 1</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="comment">#some lena notes are also used to mark silence. Utterances with these markings should not be linkable, unless they have been transcribed (i.e. unless lena was wrong to mark them as silence). See DBConstants.LENA_NOTES_CODES for specific details.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        notes_opt = DBConstants.LENA_NOTES_CODES.get_option(self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a466c2ea3760090cb4335d2e5138b14ef">lena_notes</a>)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span> is_linkable <span class="keywordflow">and</span> notes_opt != <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a>:</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            is_linkable = notes_opt.is_linkable</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">return</span> is_linkable</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">## This method checks this Utterance for errors/warnings (e.g. invalid transcriber codes, ambiguous I/C codes, etc.). These are added to the error_collector object.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">#  @param error_collector (ErrorCollector) An object used to organize and retreive errors in various ways (see data_structs.error_collector.py), so the UI can present them nicely. This method collects errors and adds them to this object.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ab855f1b49bcff75a9209c98a8db1bf3e">   76</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ab855f1b49bcff75a9209c98a8db1bf3e" title="This method checks this Utterance for errors/warnings (e.g.">validate</a>(self, error_collector):</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        warnings = []</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        errors = []</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">#if self.is_linkable(): #eliminates silence, media, nonverbal-noise, and other types that don&#39;t require transcription</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a>:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">#note: for now, we don&#39;t validate the speaker, since it&#39;s not always possible to determine who&#39;s speaking with the transcriber multi-line schema</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="comment">#if not self.trans_phrase:</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">#    error_collector.add(ParserWarning(&#39;Utterance has no transcription phrase.&#39;, self))</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="comment">#else:</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a>:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="comment">#search for invalid character in trascription phrase</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="comment">#replace angle bracket alternative encodings</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                self.trans_phrase.replace(<span class="stringliteral">&#39;&amp;lt;&#39;</span>, <span class="stringliteral">&#39;&lt;&#39;</span>).replace(<span class="stringliteral">&#39;&amp;gt;&#39;</span>, <span class="stringliteral">&#39;&gt;&#39;</span>)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                bad_chars = re.findall(<span class="stringliteral">&#39;[^A-Za-z\&#39;\&quot;&lt;&gt;\s\^]&#39;</span>, self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a>)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">#remove duplicates</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                bad_chars = dict(zip(bad_chars, [<span class="keyword">True</span>] * len(bad_chars))).keys()</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="keywordflow">if</span> bad_chars:</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    bad_chars_str = reduce(<span class="keyword">lambda</span> accum, c: <span class="stringliteral">&#39;%s, &quot;%c&quot;&#39;</span> % (accum, c),</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                           bad_chars[1:],</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                           <span class="stringliteral">&#39;&quot;%c&quot;&#39;</span> % (bad_chars[0]))</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Transcription phrase contains the following invalid characters: %s&#39;</span> % (bad_chars_str), self))</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="comment">#this can happen if the TRS file&#39;s XML structure gets messed up</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a50f772a9e22e270aba1674075821f6d6">start</a> == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Parser was unable to determine utterance start time.&#39;</span>, self))</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a3ea486724bfb440a2cd2d1b98dc60247">end</a> == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Parser was unable to determine utterance end time.&#39;</span>, self))</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a466c2ea3760090cb4335d2e5138b14ef">lena_notes</a>:</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">if</span> DBConstants.LENA_NOTES_CODES.get_option(self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#a466c2ea3760090cb4335d2e5138b14ef">lena_notes</a>) == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Unrecognized LENA note.&#39;</span>, self))</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="comment">#make sure we have the right number of transcriber codes</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#acfdb3eece980298c709712c4e24470ac">trans_phrase</a>:</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">if</span> len(self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac1f1a12c625d9ecfead4ce9a95b0ffd2">trans_codes</a>) &lt; len(DBConstants.TRANS_CODES):</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Utterance has less than %d transcriber codes.&#39;</span> % (len(DBConstants.TRANS_CODES)), self))</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                i = 0</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                bad_indices = []</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac1f1a12c625d9ecfead4ce9a95b0ffd2">trans_codes</a>)):</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    error_msgs = DBConstants.TRANS_CODES[i].is_valid(self.<a class="code" href="classdata__structs_1_1utterance_1_1_utterance.html#ac1f1a12c625d9ecfead4ce9a95b0ffd2">trans_codes</a>[i])</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="keywordflow">if</span> error_msgs:</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        bad_indices.append({<span class="stringliteral">&#39;index&#39;</span>: i + 1, <span class="stringliteral">&#39;error_msgs&#39;</span>: error_msgs})</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="keywordflow">if</span> bad_indices:</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    err_str = <span class="stringliteral">&#39;Utterance transcriber codes contain the following errors:\n&#39;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="keywordflow">for</span> issue <span class="keywordflow">in</span> bad_indices:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        err_str += <span class="stringliteral">&#39;  Code %d:\n&#39;</span> % (issue[<span class="stringliteral">&#39;index&#39;</span>])</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        <span class="keywordflow">for</span> msg <span class="keywordflow">in</span> issue[<span class="stringliteral">&#39;error_msgs&#39;</span>]:</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                            err_str += <span class="stringliteral">&#39;    -%s\n&#39;</span> % (msg)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(err_str, self))</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_8dba4be13e7b5b450dd533232b439a45.html">data_structs</a></li><li class="navelem"><a class="el" href="utterance_8py.html">utterance.py</a></li>
    <li class="footer">Generated on Fri Jan 9 2015 16:37:10 for Baby Language Lab Scripts by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
