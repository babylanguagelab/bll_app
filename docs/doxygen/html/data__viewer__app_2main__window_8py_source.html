<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Baby Language Lab Scripts: C:/Users/Wayne/Documents/baby-lab/bll_app/ui/data_viewer_app/main_window.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bll_icon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Baby Language Lab Scripts
   </div>
   <div id="projectbrief">A collection of data processing tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('data__viewer__app_2main__window_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">main_window.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="data__viewer__app_2main__window_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="code" href="namespaceui_1_1data__viewer__app_1_1main__window.html">    1</a></span>&#160;<span class="keyword">from</span> gi.repository <span class="keyword">import</span> Gtk <span class="keyword">as</span> gtk</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> gi.repository <span class="keyword">import</span> Gdk <span class="keyword">as</span> gdk</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> gi.repository <span class="keyword">import</span> GdkPixbuf</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> csv</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> logging</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> traceback</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> os</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span> subprocess</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedb_1_1bll__database.html">db.bll_database</a> <span class="keyword">import</span> DBConstants</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedb_1_1csv__database.html">db.csv_database</a> <span class="keyword">import</span> CSVDatabase</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1ui__utils.html">utils.ui_utils</a> <span class="keyword">import</span> UIUtils</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1progress__dialog.html">utils.progress_dialog</a> <span class="keyword">import</span> ProgressDialog</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1backend__utils.html">utils.backend_utils</a> <span class="keyword">import</span> BackendUtils</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1praat__interop.html">utils.praat_interop</a> <span class="keyword">import</span> PraatInterop</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparsers_1_1wav__parser.html">parsers.wav_parser</a> <span class="keyword">import</span> WavParser</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceui_1_1data__viewer__app_1_1filter__window.html">ui.data_viewer_app.filter_window</a> <span class="keyword">import</span> FilterWindow</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html">   21</a></span>&#160;<span class="keyword">class </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html">MainWindow</a>():</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">#if none of these match, then string is used</span></div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aef2bbeffa991d5cffe5e859871ddf26a">   23</a></span>&#160;    DATA_TYPE_REGEXS = {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        float: <span class="stringliteral">r&#39;^-?\d+(\.\d+)?$&#39;</span>,</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        bool: <span class="stringliteral">r&#39;^True|False$&#39;</span>,</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        }</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af36a3c3173528074e053a89cba019da5">   28</a></span>&#160;    START_COL_NAMES = [<span class="stringliteral">&#39;Start Time&#39;</span>, <span class="stringliteral">&#39;Wav.Begin&#39;</span>]</div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ad51dbf7762857f80b0b4fcf0a7006b36">   29</a></span>&#160;    END_COL_NAMES = [<span class="stringliteral">&#39;End Time&#39;</span>, <span class="stringliteral">&#39;Wav.End&#39;</span>]</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a6c699ea8ac51df7f9ca104235d02f819">   30</a></span>&#160;    DUR_COL_NAMES = [<span class="stringliteral">&#39;Duration&#39;</span>, <span class="stringliteral">&#39;Segment_Duration&#39;</span>]</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a6562774d50db7420a2631393353dcbf2">   31</a></span>&#160;    EL_TIME_COL_NAMES = [<span class="stringliteral">&#39;Elapsed_Time&#39;</span>]</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    </div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aab715bc97dffc967e231ecff67be7556">   33</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aab715bc97dffc967e231ecff67be7556">__init__</a>(self):</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a0c9cdafe4b6903f96469910316a2485d">   34</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a0c9cdafe4b6903f96469910316a2485d">window</a> = gtk.Window(gtk.WindowType.TOPLEVEL)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        self.window.set_title(<span class="stringliteral">&#39;Data Viewer&#39;</span>)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        self.window.connect(<span class="stringliteral">&#39;destroy&#39;</span>, <span class="keyword">lambda</span> w: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a72acd3c1b498c2fe9cef1139411e1f71">_clean_up</a>())</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        self.window.set_border_width(10)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        self.window.set_default_size(800, 600)</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aef2c2ef6949c7921c1ad87de96147672">   39</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aef2c2ef6949c7921c1ad87de96147672">logger</a> = logging.getLogger(__name__)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                         </div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">   41</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a> = UIUtils.open_file(<span class="stringliteral">&#39;Select csv file&#39;</span>, filters=[UIUtils.CSV_FILE_FILTER, UIUtils.ALL_FILE_FILTER])</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        self.window.set_title(<span class="stringliteral">&#39;%s - %s&#39;</span> % (self.window.get_title(), os.path.basename(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a>)))</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a>:</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            exit(0)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">   46</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a> = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#afa3890cf5d4881988f0982d9020317f7">_get_wav_filename</a>()</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3a11bdb1695b26cdd459d1dc770bbd62">   47</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3a11bdb1695b26cdd459d1dc770bbd62">wav_parser</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a>:</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3a11bdb1695b26cdd459d1dc770bbd62">wav_parser</a> = <a class="code" href="classparsers_1_1wav__parser_1_1_wav_parser.html" title="This class manipulates and plays WAV audio files.">WavParser</a>(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="comment"># if not self.wav_filename:</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="comment">#     exit(0)</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">   53</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        col_datatypes, col_headers = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a03144f1d17c4f021b850a6611628b695">_get_col_info</a>()</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        db = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae8a47a2279e9f2b6165eeec284dd8b50">_build_db</a>(col_datatypes, col_headers)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        model = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a221e156835ac07653dbbce42c5b4b0a3">_get_model</a>(col_datatypes)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        treeview = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a995e4c96402e76e042c1585e31789f4e">_get_treeview</a>(model, col_headers, db)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">   62</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">filters</a> = []</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a45ff5055c0ef4ce531adddee9ae75473">   63</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a45ff5055c0ef4ce531adddee9ae75473">where_cond</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aa4ee6701cf3193c9c8576178fc26a752">   64</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aa4ee6701cf3193c9c8576178fc26a752">where_params</a> = []</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">   65</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">   66</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ab7c728b7196557bc6f98e6de6d8bd3">_populate_model</a>(db, model)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        toolbar = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a001ecb685970ec2515836e1fbb4c329b">_build_toolbar</a>(db, treeview, col_headers)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        scrolled_win = gtk.ScrolledWindow()</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        scrolled_win.set_policy(gtk.PolicyType.AUTOMATIC, gtk.PolicyType.AUTOMATIC)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        scrolled_win.add(treeview)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        vbox = gtk.VBox()</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        vbox.pack_start(toolbar, <span class="keyword">False</span>, <span class="keyword">False</span>, 0)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        vbox.pack_start(scrolled_win, <span class="keyword">True</span>, <span class="keyword">True</span>, 0)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        self.window.add(vbox)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        self.window.show_all()</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#afa3890cf5d4881988f0982d9020317f7">   81</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#afa3890cf5d4881988f0982d9020317f7">_get_wav_filename</a>(self):</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        wav_filename = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">#try to find a wav file with the same name as the csv file</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">if</span> self.csv_filename.lower().endswith(<span class="stringliteral">&#39;.csv&#39;</span>):</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            default_filename = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a>[:-3] + <span class="stringliteral">&#39;wav&#39;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">if</span> os.path.exists(default_filename):</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                wav_filename = default_filename</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">#if the above didn&#39;t succeed, prompt the user for a filename</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> wav_filename:</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            wav_filename = UIUtils.open_file(title=<span class="stringliteral">&#39;Select wav file&#39;</span>, filters=[UIUtils.WAV_FILE_FILTER, UIUtils.ALL_FILE_FILTER])</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">return</span> wav_filename</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a39b75d303baf65646640276165370309">   96</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a39b75d303baf65646640276165370309">_get_csv_delim</a>(self, csv_file):</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        pos = csv_file.tell()</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        delim = <span class="stringliteral">&#39;,&#39;</span> <span class="keywordflow">if</span> csv_file.next().find(<span class="stringliteral">&#39;,&#39;</span>) &gt; -1 <span class="keywordflow">else</span> <span class="stringliteral">&#39;\t&#39;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        csv_file.seek(pos)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">return</span> delim</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a03144f1d17c4f021b850a6611628b695">  103</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a03144f1d17c4f021b850a6611628b695">_get_col_info</a>(self):</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        csv_file = open(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a>, <span class="stringliteral">&#39;rb&#39;</span>)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        delim = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a39b75d303baf65646640276165370309">_get_csv_delim</a>(csv_file)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        reader = csv.reader(csv_file, delimiter=delim)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        headers = reader.next()</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        line = reader.next()</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        datatypes = [int] <span class="comment">#for hidden id column</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        headers = [<span class="stringliteral">&#39;id&#39;</span>] + headers</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">for</span> col <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            datatypes.append(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af16b7f0181147c4bf70d3d4d65c7461d">_get_datatype</a>(col))</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        csv_file.close()</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">#append marked column, if not already present</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">if</span> datatypes <span class="keywordflow">and</span> <span class="keywordflow">not</span> datatypes[-1] == bool:</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            datatypes.append(bool)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            headers.append(<span class="stringliteral">&#39;Marked&#39;</span>)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">return</span> datatypes, headers</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af16b7f0181147c4bf70d3d4d65c7461d">  124</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af16b7f0181147c4bf70d3d4d65c7461d">_get_datatype</a>(self, col_val):</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        col_type = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        i = 0</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        regex_keys = MainWindow.DATA_TYPE_REGEXS.keys()</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">while</span> <span class="keywordflow">not</span> col_type <span class="keywordflow">and</span> i &lt; len(regex_keys):</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">if</span> re.match(MainWindow.DATA_TYPE_REGEXS[regex_keys[i]], col_val):</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                col_type = regex_keys[i]</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            i += 1</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> col_type:</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            col_type = str</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">return</span> col_type</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a221e156835ac07653dbbce42c5b4b0a3">  138</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a221e156835ac07653dbbce42c5b4b0a3">_get_model</a>(self, col_datatypes):</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">#tell the treeview that all columns are strings (even those that are really floats). This way, floats and numbers will appear exactly as they do in the input spreadsheet, and not using gtk&#39;s default precision (i.e. we don&#39;t have to do any number formatting / rounding). Since the db has the actual types for its columns, and it is in change of filtering and sorting (NOT the UI), this works out fine.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">#The exception is the last column (&#39;marked&#39;); it requires type bool for the checkboxes to function properly in the ui</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        col_types = [int] + [str] * (len(col_datatypes) - 2) + [bool]</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> gtk.ListStore(*col_types)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a995e4c96402e76e042c1585e31789f4e">  146</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a995e4c96402e76e042c1585e31789f4e">_get_treeview</a>(self, model, headers, db):</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        treeview = gtk.TreeView(model)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">#force the row selection colours to stay the same even when the treeview is deselected (otherwise the selection is hard to see - and seeing this at all times is important in this app&#39;s use cases)</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        treeview.modify_base(gtk.StateFlags.ACTIVE, gdk.Color.parse(<span class="stringliteral">&#39;#3399FF&#39;</span>)[1])</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        treeview.modify_text(gtk.StateFlags.ACTIVE, gdk.Color.parse(<span class="stringliteral">&#39;#FFFFFF&#39;</span>)[1])</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        col_index = 0</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        col = gtk.TreeViewColumn(headers[0], gtk.CellRendererText(), text=col_index)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        col.set_visible(<span class="keyword">False</span>)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        treeview.append_column(col)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">for</span> col_index <span class="keywordflow">in</span> range(1, len(headers) - 1):</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            col = gtk.TreeViewColumn(headers[col_index], gtk.CellRendererText(), text=col_index)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            col.set_resizable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            col.set_reorderable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            col.set_visible(col.get_title() != <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">and</span> col.get_title() != <span class="stringliteral">&#39;# segments&#39;</span>)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span> col.get_visible():</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                col.set_clickable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                col.connect(<span class="stringliteral">&#39;clicked&#39;</span>, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#add3d9fbde6b179809bb5f995fafcef2b">_toggle_sort_column</a>, treeview, db, col_index)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            treeview.append_column(col)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        toggleRenderer = gtk.CellRendererToggle()</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        toggleRenderer.connect(<span class="stringliteral">&#39;toggled&#39;</span>, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a82672185ce93f5d6d115fd6890ab2634">_toggle_renderer_callback</a>, model, col_index + 1, db)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        mark_col = gtk.TreeViewColumn(headers[col_index + 1], toggleRenderer, active=col_index + 1)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        mark_col.set_resizable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        mark_col.set_reorderable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        mark_col.set_clickable(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        mark_col.connect(<span class="stringliteral">&#39;clicked&#39;</span>, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#add3d9fbde6b179809bb5f995fafcef2b">_toggle_sort_column</a>, treeview, db, col_index + 1)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        mark_col.set_alignment(0.5) <span class="comment">#position the title in the middle, since this column&#39;s wider than the others (since it&#39;s the last visible column)</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        treeview.append_column(mark_col)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">return</span> treeview</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#add3d9fbde6b179809bb5f995fafcef2b">  180</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#add3d9fbde6b179809bb5f995fafcef2b">_toggle_sort_column</a>(self, treeview_col, treeview, db, treeview_col_index):</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">#clear any previous sort indicators on all columns except the one we care about</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">for</span> col <span class="keywordflow">in</span> treeview.get_columns():</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">if</span> col != treeview_col:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                col.set_sort_indicator(<span class="keyword">False</span>)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span> treeview_col.get_sort_indicator():</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            sort_order = treeview_col.get_sort_order()</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">if</span> sort_order == gtk.SortType.ASCENDING:</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a> = CSVDatabase.ORDER_DIRS.DESC</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a> = treeview_col_index</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                treeview_col.set_sort_order(gtk.SortType.DESCENDING)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">elif</span> sort_order == gtk.SortType.DESCENDING:</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                treeview_col.set_sort_indicator(<span class="keyword">False</span>)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a> = CSVDatabase.ORDER_DIRS.ASC</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a> = treeview_col_index</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            treeview_col.set_sort_indicator(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            treeview_col.set_sort_order(gtk.SortType.ASCENDING)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ab7c728b7196557bc6f98e6de6d8bd3">_populate_model</a>(db, treeview.get_model())</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">#for debugging</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a2e9db5ecb2962a7e0b260ce3020cd268">  210</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a2e9db5ecb2962a7e0b260ce3020cd268">_print_model</a>(self, model):</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">for</span> row <span class="keywordflow">in</span> model:</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            s = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">for</span> item <span class="keywordflow">in</span> row:</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                s += str(item) + <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">print</span> s</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a82672185ce93f5d6d115fd6890ab2634">  217</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a82672185ce93f5d6d115fd6890ab2634">_toggle_renderer_callback</a>(self, renderer, path, model, col_index, db):</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> path <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            model[path][col_index] = <span class="keywordflow">not</span> model[path][col_index]</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            db.csv_update_by_index([model.get_n_columns() - 1], where_cond=<span class="stringliteral">&#39;id=?&#39;</span>, params=[int(model[path][col_index]), model[path][0]])</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae8a47a2279e9f2b6165eeec284dd8b50">  222</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae8a47a2279e9f2b6165eeec284dd8b50">_build_db</a>(self, col_datatypes, col_headers):</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        csv_file = open(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ac78cd02e8aeefeb3b042bbd7687c05">csv_filename</a>, <span class="stringliteral">&#39;rb&#39;</span>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        delim = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a39b75d303baf65646640276165370309">_get_csv_delim</a>(csv_file)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        lines = csv_file.readlines()</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        reader = csv.reader(lines, delimiter=delim)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        header_row = reader.next() <span class="comment">#skip headers row</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        db = <a class="code" href="classdb_1_1csv__database_1_1_c_s_v_database.html" title="This class provides a way to convert a csv file into an in-memory database.">CSVDatabase</a>(col_headers, col_datatypes)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        progress_dialog = <a class="code" href="classutils_1_1progress__dialog_1_1_progress_dialog.html" title="A popup dialog box that displays a progress bar.">ProgressDialog</a>(title=<span class="stringliteral">&#39;Loading file&#39;</span>, phases=[<span class="stringliteral">&#39;Loading file...&#39;</span>])</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        progress_dialog.show()</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        num_rows = len(lines) - 1 <span class="comment">#subtract one for header</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        done = <span class="keyword">False</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        i = 0</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">while</span> i &lt; num_rows <span class="keywordflow">and</span> <span class="keywordflow">not</span> done:</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            row = reader.next()</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="comment">#if this file already contains counts at the end (has already been exported), skip those rows</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            done = row <span class="keywordflow">and</span> (row[0].startswith(<span class="stringliteral">&#39;File Stats&#39;</span>) <span class="keywordflow">or</span> row[0].startswith(<span class="stringliteral">&#39;Count of&#39;</span>))</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> done:</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="comment">#if we have a marked column, use it - otherwise, append one</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="keywordflow">if</span> re.match(MainWindow.DATA_TYPE_REGEXS[bool], row[-1]):</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    row = row[:-1] + [int(bool(row[-1] == <span class="stringliteral">&#39;True&#39;</span>))]</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    row = row + [0]</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                db.csv_insert([i + 1] + row)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">if</span> (i % 10):</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                progress_dialog.set_fraction(float(i + 1) / float(num_rows))</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            i += 1</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        progress_dialog.ensure_finish()</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        csv_file.close()</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> db</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ab7c728b7196557bc6f98e6de6d8bd3">  262</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ab7c728b7196557bc6f98e6de6d8bd3">_populate_model</a>(self, db, model):</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        model.clear()</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="comment">#order_by_indices = None</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="comment">#order_by_dirs = None</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        order_by = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a> != <span class="keywordtype">None</span> <span class="keywordflow">and</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a> != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            order_by = <span class="stringliteral">&#39;%s%s %s&#39;</span> % (CSVDatabase.COL_PREFIX, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a976aed2189e805f126507de01427a15c">sort_col</a>, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af937caad4b4084f39a3e992ad671bb28">sort_order</a>)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="comment"># order_by_indices = [self.sort_col]</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="comment"># order_by_dirs = [self.sort_order]</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment">#print self.where_cond, self.where_params, model.get_n_columns()</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        rows = db.select(</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            CSVDatabase.TABLE_NAME,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            [(<span class="stringliteral">&#39;%s%d&#39;</span> % (CSVDatabase.COL_PREFIX, i)) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(model.get_n_columns())],</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            where_cond=self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a45ff5055c0ef4ce531adddee9ae75473">where_cond</a>,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            params=self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aa4ee6701cf3193c9c8576178fc26a752">where_params</a>,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            order_by=order_by</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        )</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">#rows = db.csv_select_by_index(where_cond=self.where_cond, params=self.where_params, order_by_indices=order_by_indices, order_by_dirs=order_by_dirs)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">for</span> cur_row <span class="keywordflow">in</span> rows:</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            cur_row = list(cur_row)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, len(cur_row) - 1):</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                cur_row[i] = str(cur_row[i])</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            cur_row[-1] = bool(cur_row[-1])</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            model.append(cur_row)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1028bd130135944121af34978037ae9e">  292</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1028bd130135944121af34978037ae9e">_filter_callback</a>(self, filters, db, model, search_entry, col_headers):</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">#Filters will be None if the user clicked cancel in the FilterWindow</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">if</span> filters != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">filters</a> = filters</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            where_cond, where_params = FilterWindow.get_sql_where_cond(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">filters</a>)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a45ff5055c0ef4ce531adddee9ae75473">where_cond</a> = where_cond</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aa4ee6701cf3193c9c8576178fc26a752">where_params</a> = where_params</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4ab7c728b7196557bc6f98e6de6d8bd3">_populate_model</a>(db, model)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            desc = FilterWindow.get_filters_desc(filters, col_headers)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            search_entry.set_text(desc)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a73eb5320ac25f36fc5fc76090e801ac7">  304</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a73eb5320ac25f36fc5fc76090e801ac7">_update_filters</a>(self, db, model, col_headers, search_entry):</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <a class="code" href="classui_1_1data__viewer__app_1_1filter__window_1_1_filter_window.html">FilterWindow</a>(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">filters</a>, col_headers, <span class="keyword">lambda</span> filters: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1028bd130135944121af34978037ae9e">_filter_callback</a>(filters, db, model, search_entry, col_headers))</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a72acd3c1b498c2fe9cef1139411e1f71">  307</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a72acd3c1b498c2fe9cef1139411e1f71">_clean_up</a>(self):</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3a11bdb1695b26cdd459d1dc770bbd62">wav_parser</a>:</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            self.wav_parser.close()</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        gtk.main_quit()</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a001ecb685970ec2515836e1fbb4c329b">  313</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a001ecb685970ec2515836e1fbb4c329b">_build_toolbar</a>(self, db, treeview, col_headers):</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        toolbar = gtk.Toolbar()</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        clear_img_path = UIUtils.get_icon_path(UIUtils.BUTTON_ICONS.CLEAR, UIUtils.BUTTON_ICON_SIZES.PX16)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">#clear_pixbuf = gtk.gdk.pixbuf_new_from_file(clear_img_path)</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        clear_pixbuf = GdkPixbuf.Pixbuf.new_from_file(clear_img_path)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        search_entry = gtk.Entry()</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        search_entry.set_sensitive(<span class="keyword">False</span>)</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        search_entry.set_text(FilterWindow.get_filters_desc(self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab15e1cac6c3ae1c6739295e28af4cbff">filters</a>, col_headers))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        filter_button = UIUtils.create_button(<span class="stringliteral">&#39;Filters&#39;</span>, UIUtils.BUTTON_ICONS.FILTER, UIUtils.BUTTON_ICON_SIZES.PX16)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        filter_button.connect(<span class="stringliteral">&#39;clicked&#39;</span>, <span class="keyword">lambda</span> w: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a73eb5320ac25f36fc5fc76090e801ac7">_update_filters</a>(db, treeview.get_model(), col_headers, search_entry))</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        play_button = UIUtils.create_button(<span class="stringliteral">&#39;Play&#39;</span>, UIUtils.BUTTON_ICONS.PLAY, UIUtils.BUTTON_ICON_SIZES.PX16)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        play_button.connect(<span class="stringliteral">&#39;clicked&#39;</span>, <span class="keyword">lambda</span> w: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab9614fba801cdd492e88be1daa92eeaf">_play_selected_row</a>(col_headers, treeview))</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        praat_button = UIUtils.create_button(<span class="stringliteral">&#39;Praat&#39;</span>, UIUtils.BUTTON_ICONS.PRAAT, UIUtils.BUTTON_ICON_SIZES.PX16)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        praat_button.connect(<span class="stringliteral">&#39;clicked&#39;</span>, <span class="keyword">lambda</span> w: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7baf14ce08cd799b5a986afd99490757">_open_in_praat</a>(col_headers, treeview))</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        export_button = UIUtils.create_button(<span class="stringliteral">&#39;Export&#39;</span>, UIUtils.BUTTON_ICONS.EXPORT, UIUtils.BUTTON_ICON_SIZES.PX16)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        export_button.connect(<span class="stringliteral">&#39;clicked&#39;</span>, <span class="keyword">lambda</span> w: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1a4d919c93296905fec8fdc56237e970">_export</a>(treeview, col_headers, db))</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        context_label = gtk.Label(<span class="stringliteral">&#39;Context&#39;</span>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        context_adj = gtk.Adjustment(value=0, lower=0, upper=99, step_increment=1)</div>
<div class="line"><a name="l00337"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae3096db95e5997533be53e2f88bdd0b7">  337</a></span>&#160;        self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae3096db95e5997533be53e2f88bdd0b7">context_spinner</a> = gtk.SpinButton()</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        self.context_spinner.set_adjustment(context_adj)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        self.context_spinner.set_numeric(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        spacer = gtk.SeparatorToolItem()</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        spacer.set_draw(<span class="keyword">False</span>) <span class="comment">#don&#39;t draw a vertical line</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        spacer.set_expand(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        filter_label = gtk.Label(<span class="stringliteral">&#39;Filter state:&#39;</span>)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">for</span> widget <span class="keywordflow">in</span> [filter_label, search_entry, filter_button, praat_button, play_button, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae3096db95e5997533be53e2f88bdd0b7">context_spinner</a>, context_label]:</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            tool_item = gtk.ToolItem()</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            tool_item.add(widget)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">if</span> widget == search_entry:</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                tool_item.set_expand(<span class="keyword">True</span>)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            toolbar.insert(tool_item, -1)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        toolbar.insert(spacer, -1)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        tool_item = gtk.ToolItem()</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        tool_item.add(export_button)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        toolbar.insert(tool_item, -1)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">return</span> toolbar</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">#Takes a time string in one of two formats, and returns a float set to the absolute number of seconds it represents.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">#time_str must be either a string in any of the formats accepted by BackendUtils.time_str_to_float(), or a stringified float.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment"># (e.g. &#39;&#39;00:00:3.45 or &#39;3.45&#39;)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">  365</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">_get_abs_time</a>(self, time_str):</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        sec = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;:&#39;</span> <span class="keywordflow">in</span> time_str:</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            sec = BackendUtils.time_str_to_float(time_str)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            sec = float(time_str)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">return</span> sec</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a8afffa2f0fcaf275ae78e22782b8d040">  375</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a8afffa2f0fcaf275ae78e22782b8d040">_get_sel_row_clip_info</a>(self, col_headers, treeview):</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        start = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        end = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        model, it = treeview.get_selection().get_selected()</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> it:</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="comment">#find start and end column indices (if not already found)</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a> == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                start_index, end_index, dur_index, el_time_index = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a60b50c7233bc808ade791fa56288016b">_get_sound_col_indices</a>(col_headers)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <span class="keywordflow">if</span> start_index &gt; -1 <span class="keywordflow">and</span> end_index &gt; -1:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a> = (</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        <span class="keyword">lambda</span> model, it: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">_get_abs_time</a>(model.get_value(it, start_index)),</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        <span class="keyword">lambda</span> model, it: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">_get_abs_time</a>(model.get_value(it, end_index)),</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                        )</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="keywordflow">elif</span> dur_index &gt; -1 <span class="keywordflow">and</span> el_time_index &gt; -1:</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a> = (</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                        <span class="keyword">lambda</span> model, it: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">_get_abs_time</a>(float(model.get_value(it, el_time_index))),</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        <span class="keyword">lambda</span> model, it: self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aabad2717a57425c937cd6363a5390af4">_get_abs_time</a>(float(model.get_value(it, el_time_index)) + float(model.get_value(it, dur_index))),</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        )</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    error_msg = <span class="stringliteral">&#39;The program was unable to derive the sound clip start and end times from the columns.\n&#39;</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    error_msg += <span class="stringliteral">&#39;\nColumn headers must include:\n&#39;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    error_msg += <span class="stringliteral">&#39;-One start name: %s\n&#39;</span> % (<span class="stringliteral">&#39; or &#39;</span>.join([<span class="stringliteral">&#39;&quot;%s&quot;&#39;</span> % (name) <span class="keywordflow">for</span> name <span class="keywordflow">in</span> MainWindow.START_COL_NAMES]))</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    error_msg += <span class="stringliteral">&#39;-One end name: %s\n&#39;</span> % (<span class="stringliteral">&#39; or &#39;</span>.join([<span class="stringliteral">&#39;&quot;%s&quot;&#39;</span> % (name) <span class="keywordflow">for</span> name <span class="keywordflow">in</span> MainWindow.END_COL_NAMES]))</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    error_msg += <span class="stringliteral">&#39;\nOr alternatively:\n&#39;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    error_msg += <span class="stringliteral">&#39;-One duration name: %s\n&#39;</span> % (<span class="stringliteral">&#39; or &#39;</span>.join([<span class="stringliteral">&#39;&quot;%s&quot;&#39;</span> % (name) <span class="keywordflow">for</span> name <span class="keywordflow">in</span> MainWindow.DUR_COL_NAMES]))</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    error_msg += <span class="stringliteral">&#39;-One elapsed time name: %s\n&#39;</span> % (<span class="stringliteral">&#39; or &#39;</span>.join([<span class="stringliteral">&#39;&quot;%s&quot;&#39;</span> % (name) <span class="keywordflow">for</span> name <span class="keywordflow">in</span> MainWindow.EL_TIME_COL_NAMES]))</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    error_msg += <span class="stringliteral">&#39;\nPlease make sure your input spreadsheet contains one of these pairs.&#39;</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    UIUtils.show_message_dialog(error_msg)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a> != <span class="keywordtype">None</span> <span class="keywordflow">and</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a>:</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    start = float( self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a>[0](treeview.get_model(), it) )</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    end = float( self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7b649bfc1a5bd9e6c36c813e21cbb64f">sound_col_fcns</a>[1](treeview.get_model(), it) )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">except</span> ValueError <span class="keyword">as</span> err:</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    UIUtils.show_message_dialog(<span class="stringliteral">&#39;The program was unable to determine start and end times for this row.&#39;</span>)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    start = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    end = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                    <span class="keywordflow">print</span> err</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            UIUtils.show_no_sel_dialog()</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span> start, end</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7baf14ce08cd799b5a986afd99490757">  425</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a7baf14ce08cd799b5a986afd99490757">_open_in_praat</a>(self, headers, treeview):</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        start, end = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a8afffa2f0fcaf275ae78e22782b8d040">_get_sel_row_clip_info</a>(headers, treeview)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a> <span class="keywordflow">and</span> start != <span class="keywordtype">None</span> <span class="keywordflow">and</span> end != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            PraatInterop.open_praat()</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            PraatInterop.send_commands(PraatInterop.get_open_clip_script(start, end, self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ac671aa9c8f48b892e112fa6d2df052b6">wav_filename</a>))</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab9614fba801cdd492e88be1daa92eeaf">  432</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ab9614fba801cdd492e88be1daa92eeaf">_play_selected_row</a>(self, col_headers, treeview):</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">#this populates self.wav_parser and self.wav_filename, if the file exists</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        start, end = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a8afffa2f0fcaf275ae78e22782b8d040">_get_sel_row_clip_info</a>(col_headers, treeview)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3a11bdb1695b26cdd459d1dc770bbd62">wav_parser</a> <span class="keywordflow">and</span> start != <span class="keywordtype">None</span> <span class="keywordflow">and</span> end != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            start = max(0, start - self.context_spinner.get_value())</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            end = min(self.wav_parser.get_sound_len(), end + self.context_spinner.get_value())</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            self.wav_parser.play_clip(start, end)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="comment">#return the focus to the currenly selected row in the treeview, so the user can immediately press the down arrow to move on to the next row</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        treeview.grab_focus()</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">  444</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">_find_col</a>(self, header_dict, key_list):</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        index = -1</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        i = 0</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">while</span> index &lt; 0 <span class="keywordflow">and</span> i &lt; len(key_list):</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">if</span> key_list[i] <span class="keywordflow">in</span> header_dict:</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                index = header_dict[ key_list[i] ]</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            i += 1</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">return</span> index</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a60b50c7233bc808ade791fa56288016b">  455</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a60b50c7233bc808ade791fa56288016b">_get_sound_col_indices</a>(self, headers):</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        header_dict = dict( zip(headers, range(len(headers))) )</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        start = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">_find_col</a>(header_dict, MainWindow.START_COL_NAMES)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        end = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">_find_col</a>(header_dict, MainWindow.END_COL_NAMES)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        dur = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">_find_col</a>(header_dict, MainWindow.DUR_COL_NAMES)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        el_time = self.<a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a4b6dac7cdde865629a5546105eb646f0">_find_col</a>(header_dict, MainWindow.EL_TIME_COL_NAMES)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">return</span> (start, end, dur, el_time)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1a4d919c93296905fec8fdc56237e970">  465</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1a4d919c93296905fec8fdc56237e970">_export</a>(self, treeview, col_headers, db):</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        write_filename, open_now = UIUtils.save_file(filters=[UIUtils.CSV_FILE_FILTER, UIUtils.ALL_FILE_FILTER], open_now_opt=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">if</span> write_filename: <span class="comment">#if they didn&#39;t click cancel</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="comment">#lag_time_cutoff = float( UIUtils.show_entry_dialog(None, &#39;Lag time cutoff for counts: &#39;, default_text=&#39;2&#39;, validate_regex=r&#39;^-?\d+(\.\d+)?$&#39;, invalid_msg=&#39;Please enter a number.&#39;) )</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            lag_time_cutoff = 2.0</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> write_filename <span class="keywordflow">and</span> lag_time_cutoff != <span class="keywordtype">None</span>: <span class="comment">#if user did not click cancel (note: lag time cutoff could be 0)</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> write_filename.lower().endswith(<span class="stringliteral">&#39;.csv&#39;</span>):</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                write_filename += <span class="stringliteral">&#39;.csv&#39;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a3b94d528b402cd0a83659f8bfcdbbbbb">  476</a></span>&#160;                csv_file = open(write_filename, <span class="stringliteral">&#39;wb&#39;</span>)</div>
<div class="line"><a name="l00477"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a1997bc695f0c4839cde01f1531344ac8">  477</a></span>&#160;                writer = csv.writer(csv_file, quoting=csv.QUOTE_ALL)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a774b385c7bc6589802827b0acaa55395">  479</a></span>&#160;                cols = treeview.get_columns()</div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a38b31bbfc2876e639b69075e6a0eff6d">  480</a></span>&#160;                visible_col_indices = filter(<span class="keyword">lambda</span> i: cols[i].get_visible(), range(len(cols)))</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#af8c98536d971c870d3245918a298fa7c">  482</a></span>&#160;                filtered_headers = [col_headers[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> visible_col_indices]</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                writer.writerow(filtered_headers)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#a2f10bdb7f07c68de482a8c0bbd3be949">  485</a></span>&#160;                progress_dialog = <a class="code" href="classutils_1_1progress__dialog_1_1_progress_dialog.html" title="A popup dialog box that displays a progress bar.">ProgressDialog</a>(title=<span class="stringliteral">&#39;Exporting to file&#39;</span>, phases=[<span class="stringliteral">&#39;Exporting...&#39;</span>])</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                progress_dialog.show()</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aee2a32521f8082f237b192a5f7f72e94">  488</a></span>&#160;                num_rows = len(treeview.get_model())</div>
<div class="line"><a name="l00489"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#ae22f351e89d35ad99b9ad77cfe92d934">  489</a></span>&#160;                row_index = 1 <span class="comment">#this is awkward, but there is no way to pull all the rows out of the model in one shot, so we have to use a non-indexed for loop and manually track the index</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">for</span> row <span class="keywordflow">in</span> treeview.get_model():</div>
<div class="line"><a name="l00491"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#abba42f7aee4e73b6e0865b57fdfb7e71">  491</a></span>&#160;                    filtered_row = [row[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> visible_col_indices]</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                    writer.writerow(filtered_row)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    progress_dialog.set_fraction(float(row_index) / float(num_rows))</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    row_index += 1</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="comment"># export_stats = self._get_export_stats(lag_time_cutoff, db, col_headers)</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="comment"># if export_stats:</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="comment">#     for row in export_stats:</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="comment">#         writer.writerow(row)</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                progress_dialog.ensure_finish()</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                csv_file.close()</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <span class="keywordflow">if</span> open_now:</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    subprocess.Popen([<span class="stringliteral">&#39;%s&#39;</span> % DBConstants.SETTINGS.SPREADSHEET_PATH, write_filename])</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    UIUtils.show_message_dialog(<span class="stringliteral">&#39;Data exported successfully.&#39;</span>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="comment">#UIUtils.show_message_dialog(&#39;Data export completed.&#39;)</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> err:</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                UIUtils.show_message_dialog(<span class="stringliteral">&#39;Unable to export data - please make sure the destination file is not already open in another program.&#39;</span>)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keywordflow">raise</span> err</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno"><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aff4b2e19bca0133a793a20e58a2582ab">  516</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classui_1_1data__viewer__app_1_1main__window_1_1_main_window.html#aff4b2e19bca0133a793a20e58a2582ab">_get_export_stats</a>(self, lag_time_cutoff, db, col_headers):</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        stats = []</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        cols = {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="stringliteral">&#39;Speaker&#39;</span>: <span class="keywordtype">None</span>,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="stringliteral">&#39;Sentence Type&#39;</span>: <span class="keywordtype">None</span>,</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="stringliteral">&#39;Lag Time&#39;</span>: <span class="keywordtype">None</span>,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="stringliteral">&#39;Marked&#39;</span>: <span class="keywordtype">None</span>,</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, len(col_headers)):</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">if</span> col_headers[i] <span class="keywordflow">in</span> cols:</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                cols[col_headers[i]] = <span class="stringliteral">&#39;%s%d&#39;</span> % (CSVDatabase.COL_PREFIX, i - 1)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        have_all_cols = reduce(<span class="keyword">lambda</span> accum, key: cols[key] != <span class="keywordtype">None</span> <span class="keywordflow">and</span> accum, cols, <span class="keyword">True</span>)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> have_all_cols:</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="comment">#Count of Marked MQ -&gt; B</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="comment">#&quot;SELECT count(d1.id) FROM data d1, data d2 WHERE d1.id = d2.id - 1 AND d1.sentence_type=&#39;Q&#39; AND d2.speaker=&#39;B&#39; AND d1.marked=1 AND d1.lag_time &lt; cutoff&quot;</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            where_cond = <span class="stringliteral">&quot;d1.id = d2.id - 1 AND d1.%s = &#39;M&#39; AND d1.%s = &#39;Q&#39; AND d2.%s = &#39;B&#39; AND d1.%s = 1 AND d1.%s &lt;= ?&quot;</span> % (cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Marked&#39;</span>], cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            rows = db.select(</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="stringliteral">&#39;%s d1, %s d2&#39;</span> % (CSVDatabase.TABLE_NAME, CSVDatabase.TABLE_NAME),</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                [<span class="stringliteral">&#39;count(d1.id)&#39;</span>],</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                where_cond=where_cond,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                params=[lag_time_cutoff],</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                )</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="keywordflow">if</span> rows:</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                stats.append( [<span class="stringliteral">&#39;Count of &quot;Marked MQ -&gt; B&quot;: %d&#39;</span> % (int(rows[0][0]))] )</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="comment">#Avg lag time on mother utterance for (MQ or MD) -&gt; B</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            where_cond = <span class="stringliteral">&quot;d1.id = d2.id - 1 AND d1.%s= &#39;M&#39; AND (d1.%s = &#39;Q&#39; OR d1.%s = &#39;D&#39;) AND d2.%s = &#39;B&#39; AND d1.%s &lt;= ?&quot;</span> % (cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            rows = db.select(</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="stringliteral">&#39;%s d1, %s d2&#39;</span> % (CSVDatabase.TABLE_NAME, CSVDatabase.TABLE_NAME),</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                [<span class="stringliteral">&#39;avg(d1.%s)&#39;</span> % (cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])],</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                where_cond=where_cond,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                params=[lag_time_cutoff],</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                )</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">if</span> rows:</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                val = str(<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                <span class="keywordflow">if</span> len(rows[0]) <span class="keywordflow">and</span> rows[0][0] != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    val = <span class="stringliteral">&#39;%0.3f&#39;</span> % (float(rows[0][0]))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                stats.append( [<span class="stringliteral">&#39;Avg Lag Time for &quot;(MQ or MD) -&gt; B&quot;: %s&#39;</span> % (val)] )</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="comment">#Avg of lag time (first in pair) on mother utterance for MQ -&gt; MQ</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            where_cond = <span class="stringliteral">&quot;d1.id = d2.id - 1 AND d1.%s= &#39;M&#39; AND d1.%s = &#39;Q&#39; AND d2.%s = &#39;M&#39; AND d2.%s = &#39;Q&#39; AND d1.%s &lt;= ?&quot;</span> % (cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            rows = db.select(</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="stringliteral">&#39;%s d1, %s d2&#39;</span> % (CSVDatabase.TABLE_NAME, CSVDatabase.TABLE_NAME),</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                [<span class="stringliteral">&#39;avg(d1.%s)&#39;</span> % (cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])],</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                where_cond=where_cond,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                params=[lag_time_cutoff],</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                )</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="keywordflow">if</span> rows:</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                val = str(<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                <span class="keywordflow">if</span> len(rows[0]) <span class="keywordflow">and</span> rows[0][0] != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    val = <span class="stringliteral">&#39;%0.3f&#39;</span> % (float(rows[0][0]))</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                stats.append( [<span class="stringliteral">&#39;Avg Lag Time for &quot;MQ -&gt; MQ&quot;: %s&#39;</span> % (val)] )</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="comment">#Avg of lag time (first in pair) on mother utterance for MD -&gt; MD</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            where_cond = <span class="stringliteral">&quot;d1.id = d2.id - 1 AND d1.%s= &#39;M&#39; AND d1.%s = &#39;D&#39; AND d2.%s = &#39;M&#39; AND d2.%s = &#39;D&#39; AND d1.%s &lt;= ?&quot;</span> % (cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Sentence Type&#39;</span>], cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            rows = db.select(</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                <span class="stringliteral">&#39;%s d1, %s d2&#39;</span> % (CSVDatabase.TABLE_NAME, CSVDatabase.TABLE_NAME),</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                [<span class="stringliteral">&#39;avg(d1.%s)&#39;</span> % (cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])],</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                where_cond=where_cond,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                params=[lag_time_cutoff],</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                )</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span> rows:</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                val = str(<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                <span class="keywordflow">if</span> len(rows[0]) <span class="keywordflow">and</span> rows[0][0] != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    val = <span class="stringliteral">&#39;%0.3f&#39;</span> % (float(rows[0][0]))</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                stats.append( [<span class="stringliteral">&#39;Avg Lag Time for &quot;MD -&gt; MD&quot;: %s&#39;</span> % (val)] )</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="comment">#Avg of lag time (first in pair) on baby utterance for B -&gt; (MQ or MD)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            where_cond = <span class="stringliteral">&quot;d1.id = d2.id - 1 AND d1.%s = &#39;B&#39; AND d2.%s = &#39;M&#39; AND d1.%s &lt;= ?&quot;</span> % (cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Speaker&#39;</span>], cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            rows = db.select(</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="stringliteral">&#39;%s d1, %s d2&#39;</span> % (CSVDatabase.TABLE_NAME, CSVDatabase.TABLE_NAME),</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                [<span class="stringliteral">&#39;avg(d1.%s)&#39;</span> % (cols[<span class="stringliteral">&#39;Lag Time&#39;</span>])],</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                where_cond=where_cond,</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                params=[lag_time_cutoff],</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                )</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">if</span> rows:</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                val = str(<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                <span class="keywordflow">if</span> len(rows[0]) <span class="keywordflow">and</span> rows[0][0] != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    val = <span class="stringliteral">&#39;%0.3f&#39;</span> % (float(rows[0][0]))</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                stats.append( [<span class="stringliteral">&#39;Avg Lag Time for &quot;B -&gt; (MQ or MD)&quot;: %s&#39;</span> % (val)] )</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">if</span> stats:</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                stats.insert(0, [<span class="stringliteral">&#39;File Stats (lag time &lt;= %0.3f)&#39;</span> % (lag_time_cutoff)])</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">return</span> stats</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            </div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_1788f8309b1a812dcb800a185471cf6c.html">ui</a></li><li class="navelem"><a class="el" href="dir_c5419b99f1ba91cba3a320580621fb20.html">data_viewer_app</a></li><li class="navelem"><a class="el" href="data__viewer__app_2main__window_8py.html">main_window.py</a></li>
    <li class="footer">Generated on Tue May 5 2015 13:23:03 for Baby Language Lab Scripts by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
