<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Baby Language Lab Scripts: C:/Users/Wayne/Documents/baby-lab/bll_app/parsers/state_machines.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bll_icon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Baby Language Lab Scripts
   </div>
   <div id="projectbrief">A collection of data processing tools.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('state__machines_8py_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">state_machines.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="state__machines_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="code" href="namespaceparsers_1_1state__machines.html">    1</a></span>&#160;<span class="comment">## @package parsers.state_machines</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedata__structs_1_1utterance.html">data_structs.utterance</a> <span class="keyword">import</span> Utterance</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacedb_1_1bll__database.html">db.bll_database</a> <span class="keyword">import</span> DBConstants</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1backend__utils.html">utils.backend_utils</a> <span class="keyword">import</span> BackendUtils</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceutils_1_1enum.html">utils.enum</a> <span class="keyword">import</span> Enum</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">from</span> errors <span class="keyword">import</span> *</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span> re</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">import</span> logging</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">## This class handles the task of generating Utterance objects from the data within a \verbatim&lt;Turn&gt;&lt;/Turn&gt;\endverbatim element.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">#  Tags of interest of here:</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># \verbatim&lt;Sync time=&quot;8.32&quot; /&gt;\endverbatimThis is a single tag that indicates a boundary in the audio that LENA has found.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># \verbatim&lt;Who nb=&quot;1&quot; /&gt;\endverbatim This is a single tag that appears directly after a sync tag, or directly after another who tag.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># LENA generates who tags when there are multiple speakers within the same turn. The nb attribute</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># is the index of the speaker (starting at 1, not 0) in the (space-delimited) speaker list contained within the turn tag&#39;s &#39;speaker&#39; attribute.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># Raw data appears immediately after either of these tags. This data appears as one or more lines in the following form:</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># \verbatim</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># &lt;optional LENA code like VOC, SIL, etc.&gt; &lt;optional transcribed phrase&gt; &lt;optional LENA-generated codes separated by pipes - eg. |E|1|0|XM|&gt; &lt;optional transcriber codes separated by pipes - eg. |U|T|I|Q|&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># \endverbatim</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"># Since this data appears &lt;em&gt;after&lt;/em&gt; sync or who tags (as opposed to &lt;em&gt;between&lt;/em&gt; tags), it&#39;s tricky to pull of the information we want. Hence this state machine.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># Comment: If you need to interact with/modify this class, it would be helpful to read the transcriber manual first.</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">#</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># Usage: after instantiating the class, call drive() with each element up to (but not including) the last one. Then, call finish() with the last element.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html">   31</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html" title="This class handles the task of generating Utterance objects from the data within a.">ParseUttersStateMachine</a>(object):</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">## Constructor</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">#  @parm trs_parser (TRSParser) this state machine must be driven by an instance of the TRSParser class - this is a pointer to that instance</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">#  @param seg (Segment) this is a pointer to the Segment object for which the TRSParser is using this class to generate Utterances for.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a8d39e6306173092602062e27debe6848">   36</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a8d39e6306173092602062e27debe6848" title="Constructor.">__init__</a>(self, trs_parser, seg, remove_bad_trans_codes):</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">#since this file contains multiple classes, set up the logger so we can see which class messages are coming from</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a1ac40277274dda877122a4b2c7e43ddc">   38</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a1ac40277274dda877122a4b2c7e43ddc">logger</a> = logging.getLogger(__name__ + <span class="stringliteral">&#39;.&#39;</span> + self.__class__.__name__)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a853e41487fda10faac60706526382045">   40</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a853e41487fda10faac60706526382045">trs_parser</a> = trs_parser</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">   41</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a> = seg</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">   42</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a> = remove_bad_trans_codes</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">   44</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a> = [] <span class="comment">#list of Utterances parsed so far. These are not guarenteed to be complete (eg. may have no end time assigned) until the finish() method has been executed.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a887be5b605de0e8313a46fe640ba58cd">   45</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a887be5b605de0e8313a46fe640ba58cd">States</a> = <a class="code" href="classutils_1_1enum_1_1_enum.html" title="A primitive enum class (Python has none).">Enum</a>([<span class="stringliteral">&#39;INITIAL&#39;</span>, <span class="stringliteral">&#39;INITIAL_SYNC_TAG&#39;</span>, <span class="stringliteral">&#39;WHO_TAG&#39;</span>]) <span class="comment">#possible states - see the drive() routine for descriptions of each of them</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">   46</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> = self.States.INITIAL</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">## Pushes the state machine forward a single step.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">#  @param next_obj (Element) this is an Element object (defined in the Python ElementTree library) corresponding to the next node of the XML file that has been encountered.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee5241a093b9ac8dd6c6c1e6839f344b">   51</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee5241a093b9ac8dd6c6c1e6839f344b" title="Pushes the state machine forward a single step.">drive</a>(self, next_obj):</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="comment">#In the initial state, we wait to encounter a sync tag.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> == self.States.INITIAL:</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="keywordflow">if</span> next_obj.tag == <span class="stringliteral">&#39;Sync&#39;</span>:</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                <span class="comment">#note: next_obj.tail will be &#39;\n&#39; if this sync is immediately preceeding who tags</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                <span class="comment">#in that case self.trs_parser._parse_speech_data() will do nothing and return an empty utterance</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="comment">#This empty utterance will be popped in the next state.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                <span class="comment">#grab the speech data from the element. This call returns empty Utterance objects, one for each speaker</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                utters = self.trs_parser._parse_speech_data(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a>, next_obj, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a>)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                <span class="comment">#set the start time</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                start_time = float(next_obj.attrib[<span class="stringliteral">&#39;time&#39;</span>])</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                map(<span class="keyword">lambda</span> u: setattr(u, <span class="stringliteral">&#39;start&#39;</span>, start_time), utters)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                self.utter_list.extend(utters)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="comment">#move to next state</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> = self.States.INITIAL_SYNC_TAG</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">#In this state, we have encountered an initial sync tag, and potentially appended some new Utterances objects to self.utters_list.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="comment">#Here, we are waiting for one of two things: the next Sync tag, or a Who tag (indicating that there are multiple speakers following the previous sync)</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> == self.States.INITIAL_SYNC_TAG:</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="comment">#If we find another sync tag, it means the last one is done</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">if</span> next_obj.tag == <span class="stringliteral">&#39;Sync&#39;</span>:</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="comment">#add an end time to any utterances from a previous sync</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                end_time = float(next_obj.attrib[<span class="stringliteral">&#39;time&#39;</span>])</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="comment">#work backward through the list until we reach the point at which utters already have an end time (or we reach the beginning of the list)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                i = len(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>) - 1</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordflow">while</span> i &gt;= 0 <span class="keywordflow">and</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                    self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end = end_time</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    i -= 1</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="comment">#parse data following new sync, appending new Utterances to self.utter_list</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                new_utters = self.trs_parser._parse_speech_data(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a>, next_obj, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a>)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                start_time = float(next_obj.attrib[<span class="stringliteral">&#39;time&#39;</span>])</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                map(<span class="keyword">lambda</span> u: setattr(u, <span class="stringliteral">&#39;start&#39;</span>, start_time), new_utters)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                self.utter_list.extend(new_utters)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="comment">#leave self.cur_state the same; wait for another sync/who tag</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="comment">#If we find a who tag, the previous sync has multiple speakers</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">elif</span> next_obj.tag == <span class="stringliteral">&#39;Who&#39;</span>:</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">#pop utterance created from previous empty sync tag</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">#we should never have to pop multiple elements here because the previous sync&#39;s tail will have been be empty</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                old_utter = self.utter_list.pop()</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                self.trs_parser.total_utters -= 1</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="comment">#create and insert new utterance (from who tag) instead</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                new_utters = self.trs_parser._parse_speech_data(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a>, next_obj, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a>)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                map(<span class="keyword">lambda</span> u: setattr(u, <span class="stringliteral">&#39;start&#39;</span>, old_utter.start), new_utters)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                self.utter_list.extend(new_utters)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="comment">#go the the next state, in which we wait for the next sync/who tag (same as this state, but with some special cases).</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> = self.States.WHO_TAG</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">#In this state, we&#39;ve encountered a who tag. Wait for the next sync/who tag. This state differs from the previous one in this way:</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment"># Who tags contain no time data. If additional who tags are found (after the first who tag that got us to this state), they are given the start time of the last who tag. The first who tag was given the start time of the last sync tag (see previous state).</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> == self.States.WHO_TAG:</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">if</span> next_obj.tag == <span class="stringliteral">&#39;Sync&#39;</span>:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="comment">#finish previous utters by setting their end time</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                sync_time = float(next_obj.attrib[<span class="stringliteral">&#39;time&#39;</span>])</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                i = len(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>) - 1</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">while</span> i &gt;= 0 <span class="keywordflow">and</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end == <span class="keywordtype">None</span>: </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end = sync_time</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    i -= 1</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="comment">#create new utters</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                new_utters = self.trs_parser._parse_speech_data(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a>, next_obj, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                map(<span class="keyword">lambda</span> u: setattr(u, <span class="stringliteral">&#39;start&#39;</span>, sync_time), new_utters)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                self.utter_list.extend(new_utters)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="comment">#move back to the initial sync tag state</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> = self.States.INITIAL_SYNC_TAG</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordflow">elif</span> next_obj.tag == <span class="stringliteral">&#39;Who&#39;</span>:</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                new_utters = self.trs_parser._parse_speech_data(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a210ff68b8a0a8b17e288ce6a1e6e710b">seg</a>, next_obj, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a0d9c57e7a9c7009008a13d7bb189d80e">remove_bad_trans_codes</a>)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="comment">#give start times to previously encountered who tags</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="comment">#note: the only way we can arrive in this state is if we&#39;ve had at least one previous who tag in this segment.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                <span class="comment">#therefore the indexing below is safe.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                map(<span class="keyword">lambda</span> u: setattr(u, <span class="stringliteral">&#39;start&#39;</span>, self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[-1].start), new_utters)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                self.utter_list.extend(new_utters)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="comment">#leave self.cur_state the same; wait for another sync/who tag</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">## Completes any unfinished Utterances that may be waiting for additional information (eg. end times).</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">#  @param final_obj (Element) a Python ElementTree library XML node object, representing the last tag encountered in the \verbatim&lt;Turn&gt;&lt;/Turn&gt;\endverbatim</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a39fa3c28d93a0b73715d311ebcd0ca48">  137</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a39fa3c28d93a0b73715d311ebcd0ca48" title="Completes any unfinished Utterances that may be waiting for additional information (eg...">finish</a>(self, final_obj):</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">#grab the end time of the last node</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        final_end_time = float(final_obj.attrib[<span class="stringliteral">&#39;endTime&#39;</span>])</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">#Append the end time to any outstanding Utterances in self.utter_list</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">#note: if state == States.INITIAL, the utter list is empty and nothing needs to be done - so we only need to worry about INITIAL_SYNC_TAG and WHO_TAG states</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> == self.States.INITIAL_SYNC_TAG <span class="keywordflow">or</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#aee9922d91caf331d91f3ddf1b0b65f77">cur_state</a> == self.States.WHO_TAG:</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="comment">#add the final end time onto the last utterances</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            i = len(self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>) - 1</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">while</span> i &gt;= 0 <span class="keywordflow">and</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a>[i].end = final_end_time</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                i -= 1</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">## Retreieves the list of Utterances that this state machine has constructed.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">#  This method should only be called after finish() has been called (Otherwise there may be incomplete Utterances in the returned list)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">#  @returns (list) list of Utterance objects</span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a67bb35b60d3acecbebebb46c347fbc56">  154</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#a67bb35b60d3acecbebebb46c347fbc56" title="Retreieves the list of Utterances that this state machine has constructed.">get_result</a>(self):</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_parse_utters_state_machine.html#affa228f8812da7a1a6f137478e557567">utter_list</a></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">## This class handles the job of linking together Utterances (via their next/prev pointers) that are marked with I/C codes (transcriber code 3) by the transcribers.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">#  Utterances are &#39;linkable&#39; if an I/C code can be used to tie them to another utterance. They are &#39;unlinkable&#39; if they cannot be. Unlinkable Utterances usually consist of silence (speaker is SIL),</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">#  or non-verbal noise (and have no transcription phrase). The &#39;&#39;is_linkable column of the &#39;speaker_codes&#39; database table defines the particular speakers that make an utterance linkable/unlinkable.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">#  In addition to linking Utterances, this class also provides error detection for problems like &#39;I without C&#39;, &#39;C without I&#39;, &#39;ambiguous I/C codes&#39;, etc. These errors are appended to the TRSParser&#39;s ErrorCollector.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">#  Utterances are only linked across segments (not within segments).</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">#  The transcriber manual dictates that when ambiguous I/C codes are used, they must be numbered</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">#  (eg. I, I1, and I2, link to C, C1, and C2, respectively). These numbers are referred to as &#39;link numbers&#39; (not to be confused with &#39;segment numbers&#39;, which refer to Segment objects&#39; &#39;num&#39; attributes).</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">#  In order to simplify the linking process, the state machine considers the initial I or C codes to have the number 0 (eg. I links to C becomes I0 links to C0).</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">#  Usage: after instantiating the class, call drive() with every Utterance. Then call finish().</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html">  166</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html" title="This class handles the job of linking together Utterances (via their next/prev pointers) that are mar...">LinkUttersStateMachine</a>(object):</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">## Constructor</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">#  @param trs_parser (TRSParser) This class must be driven from an instance of a TRSParser</span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a62ce406cd632fff89dce3a7e96fba5c4">  170</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a62ce406cd632fff89dce3a7e96fba5c4" title="Constructor.">__init__</a>(self, trs_parser):</div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a355aed380232b3194c040b04c7b91d32">  171</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a355aed380232b3194c040b04c7b91d32">trs_parser</a> = trs_parser</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">#holds the link numbers of utterances with I/C codes that have been encountered in the current and previous segments, respectively</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">  174</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a> = {<span class="stringliteral">&#39;cur_links&#39;</span>: {},</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                          <span class="stringliteral">&#39;prev_links&#39;</span>: {}</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                          }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment"># holds the segment whose utterances we are currently working with</span></div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">  179</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">cur_linkable_seg</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment"># holds the segment whose utterances we were working with before we encountered cur_linkable_seg</span></div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a7bfbb060b1fac9adbc8c3b4675655dae">  181</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a7bfbb060b1fac9adbc8c3b4675655dae">last_linkable_seg</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">#set up logging</span></div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a770ea8c35c6a30397cccb6cc4b231747">  184</a></span>&#160;        self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a770ea8c35c6a30397cccb6cc4b231747">logger</a> = logging.getLogger(__name__ + <span class="stringliteral">&#39;.&#39;</span> + self.__class__.__name__)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">##Constructs a string that is formatted as indented list of information about all utterances in a given segment. This is useful to tack on to error messages.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">#  @param seg (Segment) segment object for which to generate a list of utterance info</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">#  @returns (string) an indented string containing speaker, start/end times, lena notes, transcription phrase, transcriber codes, etc. for each utterance in the segment.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2959bdce289c7cd91d8786eca247f11c">  190</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2959bdce289c7cd91d8786eca247f11c" title="Constructs a string that is formatted as indented list of information about all utterances in a given...">_get_seg_contents</a>(self, seg):</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        contents = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">for</span> utter <span class="keywordflow">in</span> seg.utters:</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            codes_str = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">if</span> utter.lena_codes:</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                codes_str += <span class="stringliteral">&#39;|%s|&#39;</span> % (<span class="stringliteral">&#39;|&#39;</span>.join(utter.lena_codes))</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">if</span> utter.trans_codes:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                codes_str = <span class="stringliteral">&#39;|%s|&#39;</span> % (<span class="stringliteral">&#39;|&#39;</span>.join(utter.trans_codes))</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                      </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            contents += <span class="stringliteral">&#39;\t%s [%s - %s] %s%s%s\n&#39;</span> % (utter.speaker.speaker_codeinfo.code <span class="keywordflow">if</span> utter.speaker <span class="keywordflow">else</span> <span class="stringliteral">&#39;-&#39;</span>,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                                     BackendUtils.get_time_str(utter.start),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                                     BackendUtils.get_time_str(utter.end),</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                     (utter.lena_notes <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>) + <span class="stringliteral">&#39; &#39;</span>,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                                     (utter.trans_phrase <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>) + <span class="stringliteral">&#39; &#39;</span>,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                                     codes_str,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                                     )</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">return</span> contents</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">## Drives the state machine ahead on step.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">#  @param next_obj (Utterance) the next Utterance to consider in the linking process</span></div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2a8931d4973fc610aa0ce1bbfc515f08">  212</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2a8931d4973fc610aa0ce1bbfc515f08" title="Drives the state machine ahead on step.">drive</a>(self, next_obj):</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">#we only drive the state machine for utterances that are linkable, and have been transcribed</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">#if next_obj.is_linkable() and next_obj.trans_phrase:</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> next_obj.trans_phrase:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="comment">#if we&#39;ve moved beyond a segment boundary (i.e. next_obj is the first utterance of a new segment), some maintanence work needs to be done on the data structures</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">cur_linkable_seg</a> == <span class="keywordtype">None</span> <span class="keywordflow">or</span> self.cur_linkable_seg.num != next_obj.seg.num:</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="comment">#Any utterances whose link numbers are left in the &#39;prev_links&#39; sub-dictionary are now too far away from their originating segment to be linked. (eg. they are from segment 2, and we are now starting segment 4 - therefore matching C/IC codes were not found in segment 3). Therefore, we generate errors for each of them.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                <span class="keywordflow">for</span> link_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>]:</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    err_msg = <span class="stringliteral">&#39;Encountered I%s with no C%s in next linkable segment.\n&#39;</span> % tuple([str(link_num <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>)] * 2)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    err_msg += <span class="stringliteral">&#39;Expected a \&#39;C\&#39; in either the current segment, or one of the these (following) segments:\n&#39;</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    err_msg += self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2959bdce289c7cd91d8786eca247f11c" title="Constructs a string that is formatted as indented list of information about all utterances in a given...">_get_seg_contents</a>(self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">cur_linkable_seg</a>)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    self.trs_parser.error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(err_msg, self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>][link_num]))</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="comment">#update the last/cur linkable segments</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a7bfbb060b1fac9adbc8c3b4675655dae">last_linkable_seg</a> = self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">cur_linkable_seg</a></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a6952fae1c992732a130bd3a0911dd961">cur_linkable_seg</a> = next_obj.seg</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="comment">#replace the &#39;prev_links&#39; sub-dictionary (has outdated entries from 2 segments ago) with the &#39;cur_links&#39; sub-dictionary (now has entries from 1 segment ago)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>] = self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>]</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="comment">#reset the &#39;cur_links&#39; sub-dictionary so we can enter link numbers for utterances from the new segment</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>] = {}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            continued_match = <span class="keywordtype">None</span> <span class="comment">#this will be set to a regex match object if next_obj contains an I transcriber code (note: could be IC)</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            continuation_match = <span class="keywordtype">None</span> <span class="comment">#this will be set to a regex match object if next_obj contains a C transcriber code (note: could be IC)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            continued_num = <span class="stringliteral">&#39;&#39;</span> <span class="comment">#if continued_match is non-None, this will be set to the link number</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            continuation_num = <span class="stringliteral">&#39;&#39;</span> <span class="comment">#if continuation_match is non-None, this will be set to the link number</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment">#make sure the Utterance has transcriber codes, then set the &#39;match&#39; variables</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">if</span> len(next_obj.trans_codes) == len(DBConstants.TRANS_CODES):</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                continued_match = re.search(<span class="stringliteral">&#39;(?:I(\d+)?)&#39;</span>, next_obj.trans_codes[2])</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                continuation_match = re.search(<span class="stringliteral">&#39;(?:C(\d+)?)&#39;</span>, next_obj.trans_codes[2])</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">#determine the link numbers for any matches</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            continued = hasattr(continued_match, <span class="stringliteral">&#39;group&#39;</span>) <span class="comment">#this is a boolean - True if continued_match is non-None</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">if</span> continued:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="comment">#if no number is present, use a 0 (i.e. match is just &#39;I&#39; or &#39;IC&#39;)</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                continued_num = continued_match.groups()[0] <span class="keywordflow">or</span> 0</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            continuation = hasattr(continuation_match, <span class="stringliteral">&#39;group&#39;</span>) <span class="comment">#this is a boolean - True if continuation_match is non-None</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span> continuation:</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="comment">#if no number is present, use a 0 (i.e. match is just &#39;C&#39; or &#39;IC&#39;)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                continuation_num = continuation_match.groups()[0] <span class="keywordflow">or</span> 0</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">#Note: if the utterance has an &#39;IC&#39; code, it is possible that both continued and continuation are True at this point</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="comment">#if there was a C code (or an IC code), search for a matching &#39;I&#39; code</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">if</span> continuation:</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="comment">#the &#39;prev_links&#39; sub-dict holds the continued utterances from last linkable segment - looking for a matching &#39;I&#39; code there</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">if</span> continuation_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>]:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                    <span class="comment">#remove (pop) the matching I/IC code from the &#39;prev_links&#39; sub-dict</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    prev_obj = self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>].pop(continuation_num)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    <span class="comment">#set the utterance pointers on both objects</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    prev_obj.next = next_obj</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    next_obj.prev = prev_obj</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="comment">#if it&#39;s not in prev_links, check cur_links (allow links to occur within the same turn)</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <span class="keywordflow">elif</span> continuation_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>]:</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="comment">#remove (pop) the matching I/IC code from the &#39;cur_links&#39; sub-dict</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                    prev_obj = self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>].pop(continuation_num)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    <span class="comment">#set the utterance pointers on both objects</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    prev_obj.next = next_obj</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    next_obj.prev = prev_obj</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="comment">#if we didn&#39;t find a matching I code, generate an error</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    err_msg = <span class="stringliteral">&#39;Encountered C%s code with no I%s code in previous linkable segment.\n&#39;</span> % tuple([str(continuation_num <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>)] * 2)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a7bfbb060b1fac9adbc8c3b4675655dae">last_linkable_seg</a>:</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                        err_msg += <span class="stringliteral">&#39;Expected an \&#39;I\&#39; either previously in the current segment, or in one of these (previous) segments:\n&#39;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        err_msg += self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a2959bdce289c7cd91d8786eca247f11c" title="Constructs a string that is formatted as indented list of information about all utterances in a given...">_get_seg_contents</a>(self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a7bfbb060b1fac9adbc8c3b4675655dae">last_linkable_seg</a>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    self.trs_parser.error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(err_msg, next_obj))</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="comment">#if there was an I code (or an IC code), insert the link number into the &#39;cur_links&#39; sub-dictionary</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">if</span> continued:</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <span class="comment">#first check if it&#39;s aready in the sub-dictionary. If so, we&#39;ve encountered it before in this segment - therefore generate an &#39;ambiguous Is&#39; error.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="keywordflow">if</span> continued_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>]:</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    self.trs_parser.error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Ambiguous I%s in segment.&#39;</span> % (str(continued_num <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>)), next_obj))</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="comment">#otherwise, we&#39;re good to insert it</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>][continued_num] = next_obj</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">## This method ensures that errors are generated for any utterances that are still waiting around for a link.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">#  This routine must be called after drive() - otherwise, you&#39;ll (potentially) be missing some errors.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">#  @param self</span></div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a9891d82003829de2758edf2c7db28ca2">  303</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#a9891d82003829de2758edf2c7db28ca2" title="This method ensures that errors are generated for any utterances that are still waiting around for a ...">finish</a>(self):</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">#Any link numbers left in the &#39;cur_links&#39; sub-dict are waiting for future utterances with corresponding C codes. They won&#39;t get any, since there are no more Utterances to process.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">#Therefore they are all &#39;I without C&#39; errors.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">for</span> link_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>]:</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            self.trs_parser.error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Encountered I%s with no C%s in next segment.&#39;</span> % tuple([str(link_num <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>)] * 2), self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;cur_links&#39;</span>][link_num]))</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment">#Any link numbers left in the &#39;prev_links&#39; sub-dict are for &#39;IC&#39; codes that were not popped because no match could be found.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">for</span> link_num <span class="keywordflow">in</span> self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>]:</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="comment">#self.trs_parser.error_collector.add(ParserError(&#39;Encountered C%s with no previous I%s code.&#39;  % tuple([str(link_num or &#39;&#39;)] * 2), self.link_dict[&#39;prev_links&#39;][link_num]))</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            self.trs_parser.error_collector.add(<a class="code" href="classparsers_1_1errors_1_1_parser_error.html" title="The class represents an error that has been detected in a TRS file.">ParserError</a>(<span class="stringliteral">&#39;Encountered I%s with no following C%s code.&#39;</span>  % tuple([str(link_num <span class="keywordflow">or</span> <span class="stringliteral">&#39;&#39;</span>)] * 2), self.<a class="code" href="classparsers_1_1state__machines_1_1_link_utters_state_machine.html#acbcf92138d36ba3ffe844a0de6b3881b">link_dict</a>[<span class="stringliteral">&#39;prev_links&#39;</span>][link_num]))</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a5a40681709ed751decc24cd7289c9c5.html">parsers</a></li><li class="navelem"><a class="el" href="state__machines_8py.html">state_machines.py</a></li>
    <li class="footer">Generated on Fri May 8 2015 09:28:20 for Baby Language Lab Scripts by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
